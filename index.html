<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,userscalable=no">
	<title>快抢月饼</title>
	<script type="text/javascript" src="lib.js"></script>
	<script type="text/javascript" src="fx.js"></script>
	<script type="text/javascript" src="fastclick.js"></script>
	<style>
		body,html{margin:0;padding:0;}
		body{height:100%;}
		.wrap{width:100%;overflow: hidden;}
		.row{list-style: none;margin: 0;padding:0;}
		.row li{width:25%;height:0px;float: left;}
		.myimg{width:100%;height:100%;}
		.row .clear{width:0;height:0;clear: both}
	</style>

</head>
<body>
	<div class="wrap">
	<ul class="row">
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="cell"><img class="myimg yuebin" src="yuebin.jpg"></li>
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="clear"></li>
	</ul>
	<ul class="row">
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="cell"><img class="myimg yuebin" src="yuebin.jpg"></li>
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="clear"></li>
	</ul>
	<ul class="row">
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="cell"><img class="myimg yuebin" src="yuebin.jpg"></li>
		<li class="cell"><img class="myimg baba" src="baba.jpg"></li>
		<li class="clear"></li>
	</ul>



</div>
<script>
	var yuebin = {
		cellHeight:0,
		hasNull:true,
		init:function(){
			this.initHeight();
			this.bindEvent();
			FastClick.attach(document.body);
		},
		initHeight:function(){
			this.cellHeight  =  document.documentElement.clientHeight/4;
			var cellHeight = this.cellHeight;
			$('.row').css({'height':cellHeight})
			$('.row .cell').css({'height':cellHeight});

			//$('.row').css({'marginTop':-cellHeight})

			$('.wrap').css({'height':document.documentElement.clientHeight});
		},
		bindEvent:function(){
			var me = this;
			$('.wrap').on('click',function(e){
				var $target = $(e.target);
				var $yuebins = $('.yuebin');

				console.log($target[0]);
				console.log($yuebins.last()[0]);
				if($target.hasClass('baba')){
					me.die();
				}else if($target[0] == $yuebins.last()[0]){
					$target.attr('src','yuebin-eat.jpg');
					$target.removeClass('yuebin');
					me.next();
				}else{
					return false;
				}
			})
		},
		die:function(){
			alert('踩到粑粑，游戏结束')
		},
		next:function(){
			var cellHeight = this.cellHeight;
			//生成0,1,2,3
			var index  = Math.floor(Math.random()*100/25);
			var html = $('<ul class="row" style="margin-top:-'+cellHeight+'px;"><li class="cell"><img class="myimg baba" src="baba.jpg"></li><li class="cell"><img class="myimg baba" src="baba.jpg"></li><li class="cell"><img class="myimg baba" src="baba.jpg"></li><li class="cell"><img class="myimg baba" src="baba.jpg"></li></ul>');
			$('.wrap').prepend(html);
			
			this.initHeight();

			
			var $newyuebin = $('.myimg').eq(index);
			//替换生成月饼
			$newyuebin.removeClass('baba');
			$newyuebin.addClass('yuebin');
			$newyuebin.attr('src','yuebin.jpg');
			
			//开始往下展现
			if(this.hasNull){
				this.hasNull = false;
				$('.row').first().animate({marginTop:0},150,'');
			}else{
				$('.row').first().animate({marginTop:0},150,'',function(){
					$('.row').last().remove();
				})
				

			}
		}


	}
	$(function(){
		yuebin.init();
	})

</script>
</body>
</html>